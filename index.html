<!DOCTYPE html><html lang="zh-CN">
<head>
  <!-- Firebase å…¼å®¹ç‰ˆ CDNï¼ˆé€‚é…æˆ‘ä»¬ç°æœ‰å†™æ³•ï¼‰ -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  // âš ï¸ æŠŠä¸‹é¢çš„é…ç½®æ¢æˆä½ åˆšå¤åˆ¶çš„ firebaseConfig
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "XXXXXXXXXXXX",
    appId: "1:XXXXXXXXXXXX:web:XXXXXXXXXXXX"
  };

  // åˆå§‹åŒ–
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // ä¸€ä¸ªå…±äº«æ–‡æ¡£ä½ç‚¹ï¼šæˆ‘ä»¬ä¿©å…±ç”¨åŒä¸€æ¡è®°å½•ï¼ˆä½ å¯ä»¥æ”¹æˆè‡ªå·±çš„IDï¼‰
  const DOC = db.collection("love-home").doc("shared");

  // ç®€å•çš„åˆå¹¶å†™å·¥å…·ï¼šæŠŠæœ¬åœ°çŠ¶æ€å†™å›äº‘ç«¯
  async function mergeDoc(patch){
    await DOC.set(patch, { merge: true });
  }

  // é¦–æ¬¡åˆ›å»ºæ–‡æ¡£ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
  DOC.get().then(snap=>{
    if(!snap.exists){
      mergeDoc({
        notes: "",
        todos: [],
        marks: [],
        countdown: null,
        updatedAt: Date.now()
      });
    }
  });

  // å®æ—¶è®¢é˜…ï¼šäº‘ç«¯å˜åŒ–â†’è‡ªåŠ¨æ›´æ–°åˆ°é¡µé¢ï¼ˆè¦†ç›–æœ¬åœ°æ˜¾ç¤ºï¼‰
  DOC.onSnapshot(snap => {
    const data = snap.data();
    if(!data) return;

    // ç•™è¨€æ¿
    if(typeof data.notes === "string"){
      const el = document.getElementById('notes');
      if(el && el !== document.activeElement){ el.value = data.notes; }
    }

    // å¾…åŠ
    if(Array.isArray(data.todos)){
      try { window.todos = data.todos; } catch(e){}
      if(typeof render === "function"){ render(); }
    }

    // æ‰“å¡
    if(Array.isArray(data.marks)){
      try { window.marks = data.marks; } catch(e){}
      if(typeof showMarks === "function"){ showMarks(); }
    }

    // å€’è®¡æ—¶
    if(data.countdown){
      const v = data.countdown; // ISOå­—ç¬¦ä¸²
      const dt = document.getElementById('dt');
      if(dt && !dt.value) dt.value = v.replace('Z',''); // ç®€å•å›æ˜¾
    }
  });
</script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é¡¾æ‰¿Ã—é±¼å®ï½œæƒ…ä¾£è‡ªå¾‹å°å®¶</title>
<link rel="manifest" href="manifest.json" />
<style>
  :root{--pink:#ff8fb3;--vio:#a78bfa;--ink:#222;--bg:#fff7fb}
  *{box-sizing:border-box}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;line-height:1.5;color:var(--ink);background:var(--bg)}
  header{padding:16px 20px;position:sticky;top:0;background:linear-gradient(180deg,#fff,rgba(255,255,255,.9));backdrop-filter:saturate(180%) blur(6px);z-index:5;border-bottom:1px solid #f2e9f5}
  h1{margin:0;font-size:18px;display:flex;align-items:center;gap:8px}
  .tabbar{position:sticky;top:56px;background:#fff;border-bottom:1px solid #f2e9f5;display:flex}
  .tabbar button{flex:1;padding:12px;border:0;background:#fff;font-weight:600}
  .tabbar button.active{color:#fff;background:var(--vio)}
  main{padding:14px 14px 80px}
  .card{background:#fff;border:1px solid #f2e9f5;border-radius:14px;padding:14px;margin:10px 0;box-shadow:0 2px 10px rgba(0,0,0,.04)}
  .row{display:flex;gap:8px;align-items:center}
  .btn{border:0;border-radius:10px;padding:10px 14px;font-weight:600}
  .btn-pink{background:var(--pink);color:#fff}
  .btn-plain{background:#f6f0fb}
  .muted{opacity:.7}
  .timer{font-variant-numeric:tabular-nums;font-size:42px;text-align:center;margin:8px 0}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#ffe2ec;margin-right:6px}
  .list{list-style:none;padding:0;margin:0}
  .list li{display:flex;justify-content:space-between;align-items:center;padding:8px;border-bottom:1px dashed #f1e7f7}
  input,textarea,select{width:100%;padding:10px;border:1px solid #eadff4;border-radius:10px;background:#fff}
  .kudo{display:none;text-align:center;font-weight:700;color:#e11d48}
  .warn{display:none;text-align:center;color:#dc2626;font-weight:700}
  .success{display:none;text-align:center;color:#16a34a;font-weight:700}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  footer{position:fixed;inset:auto 0 0 0;background:#fff;border-top:1px solid #f2e9f5;padding:12px;text-align:center}
</style>
</head>
<body>
<header>
  <h1>ğŸºé¡¾æ‰¿ Ã— ğŸŸé±¼å® Â· æƒ…ä¾£è‡ªå¾‹å°å®¶</h1>
</header>
<nav class="tabbar">
  <button class="active" data-tab="home">ğŸ  ä¸»é¡µ</button>
  <button data-tab="study">ğŸ“š è‡ªå¾‹</button>
  <button data-tab="calendar">ğŸ—“ æ‰“å¡</button>
  <button data-tab="countdown">â³ å€’è®¡æ—¶</button>
</nav>
<main>
  <!-- ä¸»é¡µ -->
  <section class="card" data-page="home">
    <p class="pill">ä»Šæ—¥ç­¾ Â· <span id="dayText">æ¬¢è¿å›å®¶ï¼Œå°ç‹ç‹¸</span></p>
    <div class="card">
      <b>ç§å¯†ç•™è¨€æ¿</b>
      <div class="muted" style="font-size:12px">å†™ç»™å½¼æ­¤çš„å°çº¸æ¡ï¼ˆä»…ä¿å­˜åœ¨ä½ æ‰‹æœºï¼‰</div>
      <textarea id="notes" rows="4" placeholder="æƒ³æˆ‘å°±å†™ç‚¹ä»€ä¹ˆï½"></textarea>
      <div style="margin-top:8px" class="row">
        <button class="btn btn-pink" onclick="saveNotes()">ä¿å­˜</button>
        <span id="saveHint" class="muted"></span>
      </div>
    </div>
  </section>  <!-- è‡ªå¾‹å­¦ä¹  -->  <section class="card" data-page="study" hidden>
    <b>ä¸“æ³¨è®¡æ—¶ï¼ˆç•ªèŒ„é’Ÿï¼‰</b>
    <div class="grid2" style="margin:8px 0">
      <select id="tomatoLen">
        <option value="25">25 åˆ†é’Ÿ</option>
        <option value="45">45 åˆ†é’Ÿ</option>
        <option value="60">60 åˆ†é’Ÿ</option>
      </select>
      <select id="breakLen">
        <option value="5">ä¼‘æ¯ 5 åˆ†é’Ÿ</option>
        <option value="10">ä¼‘æ¯ 10 åˆ†é’Ÿ</option>
      </select>
    </div>
    <div class="timer" id="timer">25:00</div>
    <div class="row">
      <button class="btn btn-pink" onclick="startFocus()">å¼€å§‹å­¦ä¹ </button>
      <button class="btn btn-plain" onclick="resetFocus()">é‡ç½®</button>
    </div>
    <div id="kudo" class="kudo">âœ… ä¹–ï¼æ‰¿å“¥å¥–åŠ±ï¼šäº²äº²åˆ¸Ã—1 ğŸ’‹</div>
    <div id="warn" class="warn">âŒ è¢«å‘ç°æºœå·å•¦ï¼å›æ¥ç»§ç»­ï¼Œå®Œæˆæ‰æœ‰å¥–åŠ±ï¼</div><div class="card">
  <b>å¾…åŠæ¸…å•</b>
  <div class="row" style="margin:6px 0">
    <input id="todoInput" placeholder="å†™ä¸‹ä»Šå¤©è¦åšçš„äº‹â€¦"/>
    <button class="btn btn-pink" onclick="addTodo()">æ·»åŠ </button>
  </div>
  <ul id="todoList" class="list"></ul>
</div>

  </section>  <!-- æ—¥å†æ‰“å¡ï¼ˆç®€ç‰ˆï¼‰ -->  <section class="card" data-page="calendar" hidden>
    <b>é€‰æ‹©æ—¥æœŸå¹¶æ‰“å¡</b>
    <div class="row" style="margin:8px 0">
      <input type="date" id="datePick" />
      <button class="btn btn-pink" onclick="markDay()">æ‰“å¡</button>
    </div>
    <div id="days" class="muted">å°šæ— æ‰“å¡</div>
  </section>  <!-- å€’è®¡æ—¶ -->  <section class="card" data-page="countdown" hidden>
    <b>å€’è®¡æ—¶æé†’</b>
    <div class="row" style="margin:8px 0">
      <input type="datetime-local" id="dt" />
      <button class="btn btn-pink" onclick="setTarget()">å¼€å§‹å€’è®¡æ—¶</button>
    </div>
    <div class="timer" id="left">è®¾ç½®ä¸€ä¸ªæ—¶é—´å§</div>
    <div id="done" class="success">ğŸ‰ æ—¶é—´åˆ°ï¼æ‹¥æŠ±å¥–åŠ±ç”Ÿæ•ˆï¼</div>
  </section>
</main>
<footer>
  <small class="muted">æœ¬åœ°éšç§å­˜å‚¨ Â· ç¦»çº¿å¯ç”¨ Â· åªç»™é±¼å®çœ‹çš„å°å®¶</small>
</footer><script>
  // â€”â€” å¯¼èˆª â€”â€”
  const tabs=[...document.querySelectorAll('.tabbar button')];
  const pages={};
  document.querySelectorAll('[data-page]').forEach(sec=>pages[sec.dataset.page]=sec);
  tabs.forEach(btn=>btn.onclick=()=>{tabs.forEach(b=>b.classList.remove('active'));btn.classList.add('active');Object.values(pages).forEach(s=>s.hidden=true);pages[btn.dataset.tab].hidden=false;localStorage.setItem('tab',btn.dataset.tab)});
  const last=localStorage.getItem('tab');if(last&&pages[last]){tabs.forEach(b=>b.classList.toggle('active',b.dataset.tab===last));Object.values(pages).forEach(s=>s.hidden=true);pages[last].hidden=false}

  // â€”â€” æ¯æ—¥ç­¾ â€”â€”
  const dayLines=["æ¬¢è¿å›å®¶ï¼Œå°ç‹ç‹¸ã€‚","è®°å¾—å–æ°´ï¼Œæˆ‘çš„ã€‚","ä»Šå¤©ä¹Ÿè¦è¢«æˆ‘äº²åˆ°è½¯ã€‚","æ”¾è½»æ¾ï¼Œæˆ‘åœ¨ã€‚","ä½ æŠ¬å¤´æ—¶åƒä¼šå‘å…‰ã€‚"];
  document.getElementById('dayText').textContent=dayLines[new Date().getDay()%dayLines.length];

  // â€”â€” ç•™è¨€æ¿ï¼ˆæœ¬åœ°æŒä¹…åŒ–ï¼‰ â€”â€”
  const notesEl=document.getElementById('notes');
  notesEl.value=localStorage.getItem('notes')||'';
  function saveNotes(){localStorage.setItem('notes',notesEl.value);mergeDoc({ notes: notesEl.value, updatedAt: Date.now() }); const hint=document.getElementById('saveHint');hint.textContent='å·²ä¿å­˜';setTimeout(()=>hint.textContent='',1200)}

  // â€”â€” ç•ªèŒ„é’Ÿ + ç›‘æ§ â€”â€”
  let t=0, total=25*60, ticking=null, focusing=false, hiddenAt=0;
  const timerEl=document.getElementById('timer'),kudo=document.getElementById('kudo'),warn=document.getElementById('warn');
  function fmt(s){const m=Math.floor(s/60).toString().padStart(2,'0');const ss=(s%60).toString().padStart(2,'0');return `${m}:${ss}`}
  function startFocus(){if(focusing) return;const work=parseInt(document.getElementById('tomatoLen').value,10);total=work*60;t=total;focusing=true;kudo.style.display='none';warn.style.display='none';tick()}
  function tick(){ticking=setInterval(()=>{t--;timerEl.textContent=fmt(t);if(t<=0){clearInterval(ticking);focusing=false;kudo.style.display='block';navigator.vibrate&&navigator.vibrate([60,40,60])}},1000)}
  function resetFocus(){clearInterval(ticking);focusing=false;t=parseInt(document.getElementById('tomatoLen').value,10)*60;timerEl.textContent=fmt(t);kudo.style.display='none';warn.style.display='none'}
  timerEl.textContent=fmt(total);
  document.addEventListener('visibilitychange',()=>{if(document.hidden){hiddenAt=Date.now()}else if(focusing){const away=(Date.now()-hiddenAt)/1000;if(away>10){warn.style.display='block'}}});

  // â€”â€” å¾…åŠ â€”â€”
  const listEl=document.getElementById('todoList');
  let todos=JSON.parse(localStorage.getItem('todos')||'[]');
  function render(){listEl.innerHTML='';todos.forEach((it,idx)=>{const li=document.createElement('li');li.innerHTML=`<span ${it.done?'class="muted"':''}>${it.text}</span>`;const btn=document.createElement('button');btn.className='btn btn-plain';btn.textContent=it.done?'æ’¤å›':'å®Œæˆ';btn.onclick=()=>{todos[idx].done=!todos[idx].done;saveTodos()};li.appendChild(btn);listEl.appendChild(li)})}
  function saveTodos(){localStorage.setItem('todos',JSON.stringify(todos));mergeDoc({ todos, updatedAt: Date.now() });render()}
  function addTodo(){const inp=document.getElementById('todoInput');const v=inp.value.trim();if(!v) return;todos.push({text:v,done:false});inp.value='';saveTodos()}
  render();

  // â€”â€” æ—¥å†æ‰“å¡ï¼ˆå­˜æ—¥æœŸï¼‰ â€”â€”
  const daysEl=document.getElementById('days');
  let marks=JSON.parse(localStorage.getItem('marks')||'[]');
  function markDay(){const val=document.getElementById('datePick').value;if(!val) return; if(!marks.includes(val)) marks.push(val); localStorage.setItem('marks',JSON.stringify(marks));mergeDoc({ marks, updatedAt: Date.now() });showMarks()}
  function showMarks(){daysEl.textContent = marks.length? 'å·²æ‰“å¡ï¼š'+marks.join('ã€') : 'å°šæ— æ‰“å¡'}
  showMarks();

  // â€”â€” å€’è®¡æ—¶ â€”â€”
  let target=null,downTimer=null;const leftEl=document.getElementById('left'),doneEl=document.getElementById('done');
  function setTarget(){const v=document.getElementById('dt').value;if(!v) return;target=new Date(v);mergeDoc({ countdown: new Date(v).toISOString(), updatedAt: Date.now() }); doneEl.style.display='none';downTimer&&clearInterval(downTimer);downTimer=setInterval(()=>{const diff=target-new Date();if(diff<=0){leftEl.textContent='00:00:00';doneEl.style.display='block';navigator.vibrate&&navigator.vibrate([90,90,120]);clearInterval(downTimer)}else{const s=Math.floor(diff/1000);const h=Math.floor(s/3600).toString().padStart(2,'0');const m=Math.floor(s%3600/60).toString().padStart(2,'0');const ss=(s%60).toString().padStart(2,'0');leftEl.textContent=`${h}:${m}:${ss}`}},1000)}
</script></body>

</html>

